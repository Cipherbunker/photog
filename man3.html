<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title></title>
<link rel="stylesheet" href="man.css" type="text/css" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:root@localhost" />
</head>

<body>



<h1 id="NAME">NAME</h1>

<p>Photography::Website</p>

<h1 id="SYNOPSIS">SYNOPSIS</h1>

<pre><code>    use Photography::Website;

    my $source      = &quot;$ENV{HOME}/Pictures&quot;;
    my $destination = &quot;$ENV{HOME}/public_html&quot;;

    # Process the pictures tree
    my $website = Photography::Website::create_album($source);

    # Generate the website
    Photography::Website::generate($website);</code></pre>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<p>The Photography::Website module contains the core of the Photog! photography website generator. If you&#39;re looking to generate websites, please refer to the photog(3) manpage for instructions and configuration options. If you want to learn about the internals of Photog!, read on.</p>

<p>A photography website is generated in two stages. The first stage searches the source directory tree for images and optional <code>photog.ini</code> files, and processes them into a data structure of nested albums. An album is simply a hash of configuration variables one of which references a list of further hashes. This stage is kicked off by the create_album() function.</p>

<p>The second stage loops through this data structure, compares all the sources with their destinations, and (re)generates them if needed. It builds a website with nested album pages than contain image thubmnails and album preview thumbnails. The structure of album pages mirrors the structure of the source image directory. This process is started with the generate() function.</p>

<h1 id="FUNCTIONS">FUNCTIONS</h1>

<p>The rest of this manpage is a description of the module&#39;s functions. They are divided into three categories. First, functions that process the source files and directories. Second, functions that generate the website resources. Third, simple helper functions.</p>

<h2 id="Source-Processing-Functions">Source Processing Functions</h2>

<dl>

<dt id="create_album-source-parent"><b>create_album</b>(<i>$source</i>[, <i>$parent</i>])</dt>
<dd>

<p>The main entry point for creating a website structure. $source should be a directory name, $parent is only used when this function is called recursively. Returns an album with nested sub-albums that represents the source directory tree.</p>

</dd>
<dt id="create_img-source-parent"><b>create_img</b>(<i>$source</i>, <i>$parent</i>)</dt>
<dd>

<p>Tries to create an image node of the file referred to by $source. Also requires a $parent that references an album node. It returns a false value if no image was created, or a reference to an image hash.</p>

</dd>
<dt id="configure-source-parent"><b>configure</b>(<i>$source</i>[, <i>$parent</i>])</dt>
<dd>

<p>Configures a new album in various ways. First, it tries to get the configuration from a file named <code>photog.ini</code> in the album&#39;s $source directory. Second, it tries to copy the configuration variables from the $parent album. Finally, it supplies default values. Returns a reference to a new album, but one that doesn&#39;t have any child nodes yet.</p>

</dd>
</dl>

<h2 id="Site-Generation-Functions">Site Generation Functions</h2>

<dl>

<dt id="generate-album-parent"><b>generate</b>(<i>$album</i>[, <i>$parent</i>])</dt>
<dd>

<p>The second main entry point that generates the actual website images and HTML files at the destinations specified inside the $album data structure. The second parameter, $parent, is only used when called recursively. It returns nothing.</p>

</dd>
<dt id="update_image-img"><b>update_image</b>(<i>$img</i>)</dt>
<dd>

<p>Given an $img node, checks if the image source is newer than the destination. If needed, it shells out to the the <code>photog-watermark</code> or <code>photog-scale</code> command (depending on the configuration) to update the website image. Then it calls <code>photog-thumbnail</code> to update the image thumbnail.</p>

</dd>
<dt id="update_album-album"><b>update_album</b>(<i>$album</i>)</dt>
<dd>

<p>Given an $album node, generates an album preview image and the album&#39;s <code>index.html</code> after sorting the album&#39;s images according to Exif date. Like the update_image() function, it only operates if an update is needed.</p>

</dd>
<dt id="update_needed-item"><b>update_needed</b>(<i>$item</i>)</dt>
<dd>

<p>The argument $item can either be an album hash or an image hash. The function returns true if the album/image&#39;s source is newer than the destination, or if the destination doesn&#39;t exist. In case of albums, it also returns true if the config file has changed. Otherwise it returns false.</p>

</dd>
<dt id="create_preview-album-parent"><b>create_preview</b>(<i>$album</i>[, <i>$parent</i>])</dt>
<dd>

<p>Creates an album preview image by making a random selection of the album&#39;s images and calling the <code>photog-preview</code> command. The optional $parent argument is passed to the select_images() function (see below).</p>

</dd>
<dt id="select_images-album-parent"><b>select_images</b>(<i>$album</i>[, <i>$parent</i>])</dt>
<dd>

<p>Returns a list of image paths that are eligible for inclusion in an album preview. If an optional $parent is supplied, it makes sure that the list only contains images whose filename does not appear in the parent album. The reason for this is that the author of Photog! likes to show the best photographs from an album on the front page, but not also have those photographs included in an album preview.</p>

</dd>
</dl>

<h2 id="Helper-Functions">Helper Functions</h2>

<dl>

<dt id="get_config-directory"><b>get_config</b>(<i>$directory</i>)</dt>
<dd>

<p>Tries to find and parse $directory/photog.ini into a configuration hash and returns a reference to it. Returns false if no photog.ini was found.</p>

</dd>
<dt id="save_config-config-directory"><b>save_config</b>(<i>$config</i>, <i>$directory</i>)</dt>
<dd>

<p>The other way around, saves the $config hash reference to the file photog.ini inside the $directory. Returns nothing.</p>

</dd>
<dt id="list-dir"><b>list</b>(<i>$dir</i>)</dt>
<dd>

<p>Returns a list of absolute pathnames to all the files and directories inside $dir.</p>

</dd>
<dt id="is_image-filename"><b>is_image</b>(<i>$filename</i>)</dt>
<dd>

<p>Returns true if the filename ends with <code>.jpg</code>.</p>

</dd>
<dt id="strip_suffix-filename"><b>strip_suffix</b>(<i>$filename</i>)</dt>
<dd>

<p>Removes all characters after the last dot of $filename, and the dot itself.</p>

</dd>
<dt id="is_newer-file1-file2"><b>is_newer</b>(<i>$file1</i>, <i>$file2</i>)</dt>
<dd>

<p>Determines the modification times of $file1 and $file2 (which should pathnames). It both files exist and $file1 is newer than $file2, it returns true. Beware: if both files are of the same age, $file1 is not newer than $file2.</p>

</dd>
<dt id="exifdate-file"><b>exifdate</b>(<i>$file</i>)</dt>
<dd>

<p>Extracts the value of the Exif tag <code>DateTimeOriginal</code> from the provided image path, converts it to ISO 8601 format, and returns it. Prints a warning and returns 0 if the Exif tag could not be found.</p>

</dd>
</dl>

<h1 id="SEE-ALSO">SEE ALSO</h1>

<p>photog(3)</p>

<h1 id="AUTHOR">AUTHOR</h1>

<p>Photography::Website was written by Jaap Joris Vens &lt;jj@rtts.eu&gt;, and is used to create his personal photography website at http://www.superformosa.nl/</p>


</body>

</html>


